"use strict";(self.webpackChunkdocusaurus_template=self.webpackChunkdocusaurus_template||[]).push([[81213],{3905:function(e,t,n){n.d(t,{Zo:function(){return p},kt:function(){return h}});var a=n(67294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var l=a.createContext({}),c=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},p=function(e){var t=c(e.components);return a.createElement(l.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},d=a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,i=e.originalType,l=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),d=c(n),h=o,m=d["".concat(l,".").concat(h)]||d[h]||u[h]||i;return n?a.createElement(m,r(r({ref:t},p),{},{components:n})):a.createElement(m,r({ref:t},p))}));function h(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var i=n.length,r=new Array(i);r[0]=d;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:o,r[1]=s;for(var c=2;c<i;c++)r[c]=n[c];return a.createElement.apply(null,r)}return a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},65470:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return s},contentTitle:function(){return l},metadata:function(){return c},toc:function(){return p},default:function(){return d}});var a=n(87462),o=n(63366),i=(n(67294),n(3905)),r=["components"],s={id:"2fa",title:"Add Two Factor Authentication (2FA) to your App",slug:"/two-factor-authentication-2fa-mfa",sidebar_label:"Add 2FA to your App"},l=void 0,c={unversionedId:"guides/2fa",id:"guides/2fa",isDocsHomePage:!1,title:"Add Two Factor Authentication (2FA) to your App",description:"Ory Kratos supports two-factor authentication. Depending on the devices used,",source:"@site/docs/guides/2fa.mdx",sourceDirName:"guides",slug:"/two-factor-authentication-2fa-mfa",permalink:"/kratos/docs/next/two-factor-authentication-2fa-mfa",editUrl:"https://github.com/ory/kratos/edit/master/docs/docs/guides/2fa.mdx",tags:[],version:"current",lastUpdatedBy:"Vincent",lastUpdatedAt:1639735450,formattedLastUpdatedAt:"12/17/2021",frontMatter:{id:"2fa",title:"Add Two Factor Authentication (2FA) to your App",slug:"/two-factor-authentication-2fa-mfa",sidebar_label:"Add 2FA to your App"},sidebar:"docs",previous:{title:"Managing Users and Identities",permalink:"/kratos/docs/next/admin/managing-users-identities"},next:{title:"Sign in with GitHub, GitLab, Google, Facebook, LinkedIn, Microsoft ...",permalink:"/kratos/docs/next/guides/sign-in-with-github-google-facebook-linkedin"}},p=[{value:"Terminology",id:"terminology",children:[{value:"Authenticator Assurance Level (AAL)",id:"authenticator-assurance-level-aal",children:[],level:3},{value:"Authentication Method Reference (AMR)",id:"authentication-method-reference-amr",children:[],level:3}],level:2},{value:"Strict and Lax Multi-Factor Authentication",id:"strict-and-lax-multi-factor-authentication",children:[],level:2},{value:"Requesting Second Factor Authentication",id:"requesting-second-factor-authentication",children:[],level:2},{value:"Time-Based One-Time Password (TOTP) / Authenticator App",id:"time-based-one-time-password-totp--authenticator-app",children:[{value:"Writing E2E Tests for TOTP",id:"writing-e2e-tests-for-totp",children:[],level:3}],level:2},{value:"Lookup Secrets",id:"lookup-secrets",children:[],level:2},{value:"FIDO2 / U2F WebAuthn",id:"fido2--u2f-webauthn",children:[{value:"Writing E2E Tests",id:"writing-e2e-tests",children:[],level:3},{value:"WebAuthN Constraints",id:"webauthn-constraints",children:[],level:3}],level:2},{value:"Build Your Own UI",id:"build-your-own-ui",children:[],level:2}],u={toc:p};function d(e){var t=e.components,s=(0,o.Z)(e,r);return(0,i.kt)("wrapper",(0,a.Z)({},u,s,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("p",null,"Ory Kratos supports two-factor authentication. Depending on the devices used,\nyou might want to call this two-factor verification depending on which features\nyou have enabled. Learn more about the distinction between two-factor\nauthentication and two-factor verification in this excellent\n",(0,i.kt)("a",{parentName:"p",href:"https://blog.1password.com/totp-for-1password-users/"},"1password")," blog post!"),(0,i.kt)("p",null,"There are four key components available in Ory Kratos with regard to\nmulti-factor authentication. For this guide, we will assume that you are using\nthe Ory Cloud Managed UI available at\n",(0,i.kt)("a",{parentName:"p",href:"https://github.com/ory/kratos-selfservice-ui-node"},"github.com/ory/kratos-selfservice-ui-node"),".\nAt the end of this guide you will find details and ideas on how to implement\nyour own UI with Ory Kratos' MFA features."),(0,i.kt)("h2",{id:"terminology"},"Terminology"),(0,i.kt)("p",null,"Before we start let's establish the key terminology to make the following\nsections easier to understand!"),(0,i.kt)("h3",{id:"authenticator-assurance-level-aal"},"Authenticator Assurance Level (AAL)"),(0,i.kt)("p",null,"The Authenticator Assurance Level (AAL) has two possible values:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"aal1"),": Implies that the identity has completed only one authentication factor\n(",(0,i.kt)("inlineCode",{parentName:"li"},"password"),", ",(0,i.kt)("inlineCode",{parentName:"li"},"oidc"),")."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"aal2"),": Implies that the identity has completed the first (",(0,i.kt)("inlineCode",{parentName:"li"},"password"),", ",(0,i.kt)("inlineCode",{parentName:"li"},"oidc"),")\nand the second (",(0,i.kt)("inlineCode",{parentName:"li"},"totp"),", ",(0,i.kt)("inlineCode",{parentName:"li"},"lookup_secrets"),", ",(0,i.kt)("inlineCode",{parentName:"li"},"webauthn"),") authentication factor\n(e.g.: ",(0,i.kt)("inlineCode",{parentName:"li"},"password")," + ",(0,i.kt)("inlineCode",{parentName:"li"},"totp"),", ",(0,i.kt)("inlineCode",{parentName:"li"},"oidc")," + ",(0,i.kt)("inlineCode",{parentName:"li"},"webauthn"),", ...). First authentication\nfactors can not be combined to gain ",(0,i.kt)("inlineCode",{parentName:"li"},"aal2")," (e.g. ",(0,i.kt)("inlineCode",{parentName:"li"},"password")," + ",(0,i.kt)("inlineCode",{parentName:"li"},"oidc")," = ",(0,i.kt)("inlineCode",{parentName:"li"},"aal1"),",\nnot ",(0,i.kt)("inlineCode",{parentName:"li"},"aal2"),")!")),(0,i.kt)("h3",{id:"authentication-method-reference-amr"},"Authentication Method Reference (AMR)"),(0,i.kt)("p",null,"The Authentication Method Reference (AMR) is an array of authentication methods\nthat were used over the lifetime of an Ory Session. In an Ory Session, this will\nhave the following layout:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json5",metastring:'title="Example Ory Session JSON Payload"',title:'"Example',Ory:!0,Session:!0,JSON:!0,'Payload"':!0},"{\n  id: '6b51a3f2-6a2c-4557-90a8-4e23de7072aa',\n  active: true,\n  // ...\n  authenticator_assurance_level: 'aal2',\n  authentication_methods: [\n    {\n      method: 'password',\n      completed_at: '2021-10-14T09:37:53.872104Z'\n    },\n    {\n      method: 'lookup_secret',\n      completed_at: '2021-10-14T09:41:16.771859Z'\n    }\n  ]\n  // ...\n}\n")),(0,i.kt)("p",null,"The methods can be one of ",(0,i.kt)("inlineCode",{parentName:"p"},"password"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"oidc"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"totp"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"webauthn"),",\n",(0,i.kt)("inlineCode",{parentName:"p"},"lookup_secrets"),". A method can be included more than once, for example when the\nidentity refreshes their Ory Session by re-authenticating with e.g. their\npassword:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json5",metastring:'title="Example Ory Session JSON Payload"',title:'"Example',Ory:!0,Session:!0,JSON:!0,'Payload"':!0},"{\n  id: '6b51a3f2-6a2c-4557-90a8-4e23de7072aa',\n  active: true,\n  // ...\n  authenticator_assurance_level: 'aal2',\n  authentication_methods: [\n    {\n      method: 'password',\n      completed_at: '2021-10-14T09:37:53.872104Z'\n    },\n    {\n      method: 'lookup_secret',\n      completed_at: '2021-10-14T09:41:16.771859Z'\n    },\n    {\n      method: 'password',\n      completed_at: '2021-10-14T12:00:00.134567Z'\n    }\n  ]\n  // ...\n}\n")),(0,i.kt)("h2",{id:"strict-and-lax-multi-factor-authentication"},"Strict and Lax Multi-Factor Authentication"),(0,i.kt)("p",null,'Before jumping into the concrete MFA modules, we take a lok at "Soft\nMulti-Factor Authentication". Ory Kratos has two endpoints which require an Ory\nSession Token or Ory Session Cookie to function:'),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"/kratos/docs/next/reference/api#operation/toSession"},(0,i.kt)("inlineCode",{parentName:"a"},"/sessions/whoami"))),(0,i.kt)("li",{parentName:"ul"},"The ",(0,i.kt)("a",{parentName:"li",href:"/kratos/docs/next/self-service/flows/user-settings"},"self-service setting flow"))),(0,i.kt)("p",null,'When you enable one of the 2FA methods, you can configure when an Ory Session\nToken or Ory Session Cookie is considered "valid" for these two endpoints:'),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml",metastring:'title="kratos.config.yml"',title:'"kratos.config.yml"'},"# ...\nselfservice:\n  flows:\n    settings:\n      required_aal: aal1\n# ...\nsession:\n  whoami:\n    required_aal: aal1\n# ...\n")),(0,i.kt)("p",null,"The field ",(0,i.kt)("inlineCode",{parentName:"p"},"required_aal")," can be one of:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"highest_available")," (default): If set, requires identities who have set up a\nsecond factor (e.g. ",(0,i.kt)("inlineCode",{parentName:"li"},"totp"),", ",(0,i.kt)("inlineCode",{parentName:"li"},"webauthn"),") to have an Ory Session where both\nfactors (e.g. ",(0,i.kt)("inlineCode",{parentName:"li"},"password")," + ",(0,i.kt)("inlineCode",{parentName:"li"},"totp"),") have been used to authenticated."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"aal1"),": Even if an identity has a second factor set up, an Ory Session with\nonly one factor (e.g. ",(0,i.kt)("inlineCode",{parentName:"li"},"oidc"),", ",(0,i.kt)("inlineCode",{parentName:"li"},"password"),") is enough to access it.")),(0,i.kt)("p",null,"For example, if you want your users to sign in without forcing the second\nfactor, you could set:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml",metastring:'title="kratos.config.yml"',title:'"kratos.config.yml"'},"# ...\nsession:\n  whoami:\n    required_aal: aal1\n# ...\n")),(0,i.kt)("p",null,"When the user is doing something that needs more security (e.g. a bank\ntransfer), you could add a check which only allows Ory Sessions that have ",(0,i.kt)("inlineCode",{parentName:"p"},"aal2"),"\nto access that feature."),(0,i.kt)("p",null,"The Ory Session, which you can get by calling the\n",(0,i.kt)("a",{parentName:"p",href:"/kratos/docs/next/reference/api#operation/toSession"},(0,i.kt)("inlineCode",{parentName:"a"},"/sessions/whoami"))," endpoint,\ncontains the session's ",(0,i.kt)("inlineCode",{parentName:"p"},"authenticator_assurance_level"),". For a session which only\ncompleted the first factor, this would be:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json5",metastring:'title="GET /session/whoami"',title:'"GET','/session/whoami"':!0},"{\n  id: '6b51a3f2-6a2c-4557-90a8-4e23de7072aa',\n  active: true,\n  // ...\n  authenticated_at: '2021-10-14T09:37:53.877216Z',\n  authenticator_assurance_level: 'aal1'\n  // ...\n}\n")),(0,i.kt)("p",null,"A session that has completed the second factor, this would be:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json5",metastring:'title="GET /session/whoami"',title:'"GET','/session/whoami"':!0},"{\n  id: '6b51a3f2-6a2c-4557-90a8-4e23de7072aa',\n  active: true,\n  // ...\n  authenticated_at: '2021-10-14T09:37:53.877216Z',\n  authenticator_assurance_level: 'aal2'\n  // ...\n}\n")),(0,i.kt)("p",null,"If ",(0,i.kt)("inlineCode",{parentName:"p"},"highest_available")," is configured for the ",(0,i.kt)("inlineCode",{parentName:"p"},"/session/whoami")," endpoint, then\nOry Kratos will instruct the user interface - if it is a browser flow - to\nredirect to the 2FA screen after the end-user signs in with their first factor."),(0,i.kt)("h2",{id:"requesting-second-factor-authentication"},"Requesting Second Factor Authentication"),(0,i.kt)("p",null,"When an end-user is signed in you may prompt them to provide their second factor\nby initiating a new Login using the\n",(0,i.kt)("a",{parentName:"p",href:"../reference/api#operation/initializeSelfServiceLoginFlowForBrowsers"},(0,i.kt)("inlineCode",{parentName:"a"},"/self-service/login/browser")),"\nor\n",(0,i.kt)("a",{parentName:"p",href:"../reference/api#operation/initializeSelfServiceLoginFlowWithoutBrowser"},(0,i.kt)("inlineCode",{parentName:"a"},"/self-service/login/api")),"\nAPI and setting the ",(0,i.kt)("inlineCode",{parentName:"p"},"aal")," parameter to ",(0,i.kt)("inlineCode",{parentName:"p"},"aal2"),". Once the end-user has provided\ntheir second factor, the method (e.g. ",(0,i.kt)("inlineCode",{parentName:"p"},"totp"),") will be added to the Or Session\nAMR, the Ory Session AAL will be set to ",(0,i.kt)("inlineCode",{parentName:"p"},"aal2"),", and ",(0,i.kt)("inlineCode",{parentName:"p"},"authenticated_at")," will be\nset to the current time."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"/self-service/login/browser?aal=aal2\n/self-service/login/api?aal=aal2\n")),(0,i.kt)("p",null,"If the Ory Session has ",(0,i.kt)("inlineCode",{parentName:"p"},"aal2")," already, this will error. In that case you can\nrequest to refresh the session using the second factor:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"/self-service/login/browser?refresh=true&aal=aal2\n/self-service/login/api?refresh=true&aal=aal2\n")),(0,i.kt)("h2",{id:"time-based-one-time-password-totp--authenticator-app"},"Time-Based One-Time Password (TOTP) / Authenticator App"),(0,i.kt)("p",null,"Time-Based One-Time Password (TOTP) is a standardized algorithm (see\n",(0,i.kt)("a",{parentName:"p",href:"https://datatracker.ietf.org/doc/html/rfc6238"},"RFC6238"),") that is used by apps\nsupported by apps like Google Authenticator\n(",(0,i.kt)("a",{parentName:"p",href:"https://apps.apple.com/us/app/google-authenticator/id388497605"},"iOS"),",\n",(0,i.kt)("a",{parentName:"p",href:"https://play.google.com/store/apps/details?id=com.google.android.apps.authenticator2"},"Android"),"),\n",(0,i.kt)("a",{parentName:"p",href:"https://support.1password.com/one-time-passwords/"},"1Password"),",\n",(0,i.kt)("a",{parentName:"p",href:"https://bitwarden.com/help/article/authenticator-keys/"},"Bitwarden"),", and many\nothers."),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"Google Authenticator App",src:n(7862).Z})),(0,i.kt)("p",null,"You can enable TOTP in your Ory Kratos config:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml",metastring:'title="kratos.config.yml"',title:'"kratos.config.yml"'},"selfservice:\n  methods:\n    totp:\n      enabled: true\n      config:\n        # The issuer (e.g. a domain name) will be shown in the TOTP app (e.g. Google Authenticator). It helps the user differentiate between different codes.\n        issuer: Example.com\n")),(0,i.kt)("p",null,"To help the user identify the correct code in their TOTP authenticator app, you\nshould set the ",(0,i.kt)("inlineCode",{parentName:"p"},"issuer")," (see code example above) to your brand name or domain\nname. However, users might have multiple identities registered in your system.\nTo help them distinguish between them, you can specify a traits in your Identity\nSchema which should be the TOTP account name (in the screenshot above\n",(0,i.kt)("inlineCode",{parentName:"p"},"alice@example.org"),"):"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-patch",metastring:'title="identity.schema.json"',title:'"identity.schema.json"'},"{\n  $schema: 'http://json-schema.org/draft-07/schema#',\n  type: 'object',\n  properties: {\n    traits: {\n      type: 'object',\n      properties: {\n        email: {\n          type: 'string',\n          format: 'email',\n          title: 'Your E-Mail',\n          minLength: 3,\n          'ory.sh/kratos': {\n            credentials: {\n              // ...\n+             totp: {\n+               account_name: true\n+             }\n            }\n            // ...\n          }\n        }\n        // ...\n      }\n      // ...\n    }\n  }\n}\n")),(0,i.kt)("p",null,"In the settings UI, the user will be presented with a QR code, a secret which\ncan be used instead of the QR code, and a field to enter a TOTP password\ngenerated by the linked TOTP app."),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"Google Authenticator App",src:n(85871).Z})),(0,i.kt)("p",null,"To complete the process, the Ory Session must be\n",(0,i.kt)("a",{parentName:"p",href:"/kratos/docs/next/concepts/session#privileged-session"},"privileged"),". Once set up, the\nend-user can unlink the TOTP device if e.g. it is lost:"),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"Google Authenticator App",src:n(53145).Z})),(0,i.kt)("h3",{id:"writing-e2e-tests-for-totp"},"Writing E2E Tests for TOTP"),(0,i.kt)("p",null,"If you wish to write TOTP tests, take a look at\n",(0,i.kt)("a",{parentName:"p",href:"https://github.com/ory/kratos/blob/fc2cecfbeab811aa1a851f953b6bc2a4c119c412/test/e2e/cypress/integration/profiles/mfa/totp.spec.ts"},"how we solve E2E tests for TOTP"),"."),(0,i.kt)("h2",{id:"lookup-secrets"},"Lookup Secrets"),(0,i.kt)("p",null,"Lookup secrets are passwords generated by the server. These passwords can only\nbe used once, and the end-user typically downloads them, stores them in their\npassword manager, or writes them down. Lookup secrets are commonly used when the\nend-user loses access to their TOTP or WebAuthn device!"),(0,i.kt)("p",null,"On your settings UI, this method could look as follows. First, the end-user\ngenerates new lookup secrets."),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"Generating new recovery codes",src:n(23410).Z})),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"New recovery codes",src:n(62394).Z})),(0,i.kt)("p",null,"The end-user must confirm these lookup secrets. This action requires a\n",(0,i.kt)("a",{parentName:"p",href:"/kratos/docs/next/concepts/session#privileged-session"},"privileged Ory Session")," and the\nuser might be prompted to confirm the action by re-authenticating!"),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"Generating new recovery codes",src:n(32579).Z})),(0,i.kt)("p",null,"Once confirmed, the end-user can use these lookup secrets as a second factor!\nWhen a code was used,"),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"Used recovery code",src:n(67596).Z})),(0,i.kt)("div",{className:"admonition admonition-warning alert alert--danger"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"}))),"warning")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"The end-user must ensure to re-generate lookup secrets before all lookup secrets\nhave been used up!"))),(0,i.kt)("p",null,'Lookup secrets are known by several names. Google for example calls them "Backup\nCodes". Another common name is "2FA Recovery Codes".'),(0,i.kt)("p",null,"You can enable this method in your Ory Kratos config:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml",metastring:'title="kratos.config.yml"',title:'"kratos.config.yml"'},"selfservice:\n  methods:\n    lookup_secret:\n      enabled: true\n")),(0,i.kt)("h2",{id:"fido2--u2f-webauthn"},"FIDO2 / U2F WebAuthn"),(0,i.kt)("p",null,"The Web Authentication Browser API (also known as WebAuthn) is a\n",(0,i.kt)("a",{parentName:"p",href:"https://w3c.github.io/webauthn/"},"specification")," written by the\n",(0,i.kt)("a",{parentName:"p",href:"https://www.w3.org/"},"W3C")," and ",(0,i.kt)("a",{parentName:"p",href:"https://fidoalliance.org/"},"FIDO"),". The WebAuthn\nAPI allows servers to register and authenticate users using public key\ncryptography instead of a password. Common use cases for WebAuthn are"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"using a USB, NFC, or Bluetooth low energy device (e.g.\n",(0,i.kt)("a",{parentName:"li",href:"https://www.yubico.com"},"YubiKey"),") to authenticate"),(0,i.kt)("li",{parentName:"ul"},'using an Operating System "platform module" (e.g. TouchID, FaceID, Windows\nHello Face, Android Biometric Authentication, ...)')),(0,i.kt)("p",null,"Configuring WebAuthn correctly is imperative, because the authentication will\nfail if something is not configured correctly."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml",metastring:'title="kratos.config.yml"',title:'"kratos.config.yml"'},"selfservice:\n  flows:\n  methods:\n    webauthn:\n      enabled: true\n      config:\n        rp:\n          # This MUST be your top-level-domain\n          id: example.org\n          # This MUST be the exact URL of the page which will prompt for WebAuthn!\n          # Only the scheme (https / http), host (auth.example.org), and port (4455) are relevant. The\n          # path is irrelevant\n          origin: http://auth.example.org:4455\n          # A display name which will be shown to the user on her/his device.\n          display_name: Ory\n")),(0,i.kt)("p",null,"Once the end-user triggers the WebAuthn process, the browser will show a\nWebAuthn prompt:"),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"WebAuthn Prompt",src:n(51046).Z})),(0,i.kt)("h3",{id:"writing-e2e-tests"},"Writing E2E Tests"),(0,i.kt)("p",null,"You will need a browser to run E2E tests using WebAuthn. Take a look at our\n",(0,i.kt)("a",{parentName:"p",href:"https://github.com/ory/kratos/blob/fc2cecfbeab811aa1a851f953b6bc2a4c119c412/test/e2e/cypress/integration/profiles/mfa/webauthn.spec.ts"},"E2E test for WebAuthn"),"\nfor ",(0,i.kt)("a",{parentName:"p",href:"https://www.cypress.io"},"Cypress"),". You can find more information about the\napproach for Cypress in\n",(0,i.kt)("a",{parentName:"p",href:"https://github.com/cypress-io/cypress/issues/6991#issuecomment-612888645"},"cypress#6991"),"."),(0,i.kt)("h3",{id:"webauthn-constraints"},"WebAuthN Constraints"),(0,i.kt)("p",null,"There are some limitations to WebAuthN to be considered in development:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"WebAuthN is a Browser standard. It does not work on native mobile apps.")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"WebAuthN is limited to one domain and does not work in a local environment\nwhen using CNAME / Ory Proxy.",(0,i.kt)("br",{parentName:"p"}),"\n","WebAuthN uses an ",(0,i.kt)("inlineCode",{parentName:"p"},"https://origin")," URL as part of the client<->server\nchallenge/response mechanism. This mechanism allows for only one URL as the\norigin. Read more in the ",(0,i.kt)("a",{parentName:"p",href:"https://webauthn.guide/"},"WebAuthN guide")," and on\n",(0,i.kt)("a",{parentName:"p",href:"https://github.com/w3c/webauthn/issues/1372"},"GitHub"),".")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Implementing WebAuthN in your own UI can be challenging, depending on which\nframework to use. Please check our\n",(0,i.kt)("a",{parentName:"p",href:"/kratos/docs/next/guides/custom-ui"},"reference implementations")," to see how we solved it for\ndifferent app types (web, single page app)."))),(0,i.kt)("h2",{id:"build-your-own-ui"},"Build Your Own UI"),(0,i.kt)("p",null,"The major benefit of Ory Kratos is that you can bring your own login,\nregistration, account recovery, ... user-interface. You can write that\nuser-interface in any language or framework! We have\n",(0,i.kt)("a",{parentName:"p",href:"/kratos/docs/next/concepts/ui-user-interface"},"reference UI implementations")," available to\nhelp you get started!"))}d.isMDXComponent=!0},23410:function(e,t,n){t.Z=n.p+"assets/images/1-be676ae65065e31098e02b7fa73374df.png"},62394:function(e,t,n){t.Z=n.p+"assets/images/2-5be8aba065d8d66c8c3665501f52e7b7.png"},67596:function(e,t,n){t.Z=n.p+"assets/images/3-729cb576d168bacea2ab2e9546ffdad5.png"},32579:function(e,t,n){t.Z=n.p+"assets/images/privileged-a77d014776ee430adcf956bb568ae675.png"},7862:function(e,t,n){t.Z=n.p+"assets/images/totp-google-auth-app-c9a3b5b41ba9868773594af5bb519bcd.png"},85871:function(e,t,n){t.Z=n.p+"assets/images/1-ae2053a6144b23007339aac056a1102e.png"},53145:function(e,t,n){t.Z=n.p+"assets/images/2-eb66b11593000a193b4ea56ef75d72ee.png"},51046:function(e,t,n){t.Z=n.p+"assets/images/1-626af5cf55ebab2ff62e4315b77e7acc.png"}}]);